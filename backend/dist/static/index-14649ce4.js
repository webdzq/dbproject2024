import{A as e,B as a,d as l,C as s,D as t,G as o,r,H as i,I as d,J as n,K as p,o as u,i as m,e as c,w as f,L as v,f as b,M as g,N as y,n as h,c as k,O as _,t as w,P as z,Q as j,h as C,R as E,S as x,u as S,s as L,q as R,a as V,F as I,U,x as O,y as N}from"./index-d5304777.js";import{E as q}from"./el-card-2b130a3f.js";import{E as A,a as $}from"./el-form-item-38df9850.js";import{u as F,E as B}from"./el-button-7384c59f.js";import{E as D}from"./el-input-18a8a90e.js";import{d as H}from"./el-tag-377e0f90.js";import{E as M,a as T}from"./el-select-ce060cba.js";import"./el-popper-20328552.js";import{E as Y,a as P}from"./el-radio-827539ee.js";import{E as K,a as G}from"./el-table-column-0c648863.js";import"./el-checkbox-b2c1ef9f.js";import{E as J}from"./el-overlay-cfbba524.js";import{_ as Q}from"./index.vue_vue_type_style_index_0_lang-9e599415.js";import{c as W}from"./index-98d51863.js";import{u as X}from"./useEmitt-da8011a9.js";import{g as Z}from"./index-104a7b48.js";import{d as ee,a as ae,u as le}from"./use-dialog-7a60bb62.js";import{E as se}from"./focus-trap-5bb091fd.js";import"./use-form-common-props-594ab9f4.js";import"./use-form-item-6b2ca231.js";import"./event-5568c9d8.js";import"./isNil-1f22f7b0.js";import"./scroll-8db753ac.js";import"./validator-a82dd364.js";import"./vnode-925e3556.js";import"./el-row-da9cc34b.js";import"./el-pagination-60cf2577.js";const te=l({name:"ElDrawer",components:{ElOverlay:J,ElFocusTrap:se,ElIcon:s,Close:t},inheritAttrs:!1,props:e({...ee,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),emits:ae,setup(e,{slots:a}){F({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},o((()=>!!a.title))),F({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},o((()=>!!e.customClass)));const l=r(),s=r(),t=i("drawer"),{t:p}=d(),u=o((()=>"rtl"===e.direction||"ltr"===e.direction)),m=o((()=>n(e.size)));return{...le(e,l),drawerRef:l,focusStartRef:s,isHorizontal:u,drawerSize:m,ns:t,t:p}}}),oe=["aria-label","aria-labelledby","aria-describedby"],re=["id"],ie=["aria-label"],de=["id"];const ne=x(a(te,[["render",function(e,a,l,s,t,o){const r=p("close"),i=p("el-icon"),d=p("el-focus-trap"),n=p("el-overlay");return u(),m(E,{to:"body",disabled:!e.appendToBody},[c(C,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:f((()=>[v(c(n,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:f((()=>[c(d,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:f((()=>[b("div",g({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:a[1]||(a[1]=y((()=>{}),["stop"]))}),[b("span",{ref:"focusStartRef",class:h(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(u(),k("header",{key:0,class:h(e.ns.e("header"))},[e.$slots.title?_(e.$slots,"title",{key:1},(()=>[z(" DEPRECATED SLOT ")])):_(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},(()=>[e.$slots.title?z("v-if",!0):(u(),k("span",{key:0,id:e.titleId,role:"heading",class:h(e.ns.e("title"))},w(e.title),11,re))])),e.showClose?(u(),k("button",{key:2,"aria-label":e.t("el.drawer.close"),class:h(e.ns.e("close-btn")),type:"button",onClick:a[0]||(a[0]=(...a)=>e.handleClose&&e.handleClose(...a))},[c(i,{class:h(e.ns.e("close"))},{default:f((()=>[c(r)])),_:1},8,["class"])],10,ie)):z("v-if",!0)],2)):z("v-if",!0),e.rendered?(u(),k("div",{key:1,id:e.bodyId,class:h(e.ns.e("body"))},[_(e.$slots,"default")],10,de)):z("v-if",!0),e.$slots.footer?(u(),k("div",{key:2,class:h(e.ns.e("footer"))},[_(e.$slots,"footer")],2)):z("v-if",!0)],16,oe)])),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])])),_:3},8,["mask","overlay-class","z-index","onClick"]),[[j,e.visible]])])),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]])),pe={class:"dialog-footer"},ue=l({__name:"index",setup(e){const{emitter:a}=X(),{push:l}=S(),s=r(),t=r(),i=L({version:"",apk:"",zips:[],forceOnline:"",device:"pad"}),d=L({pageUrl:"",commitId:"",moduleName:""}),n=r([]),p=r(!1),v=r(!1),g=o((()=>{const e=n.value.find((e=>e.apkName===i.apk));return e?e.id:""})),h=L({version:[{required:!0,message:"请输入版本号",trigger:"blur"},{validator:(e,a,l)=>{/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/.test(a)?l():l(new Error("请输入正确的版本号"))},trigger:"blur"}],apk:[{required:!0,message:"请选择apk",trigger:"change"}],zips:[{required:!0,message:"请选择zip",trigger:"change"}],forceOnline:[{required:!0,message:"请选择是否强制上线",trigger:"change"}],device:[{required:!0,message:"请选择设备类型",trigger:"change"}]}),_=()=>{var e;null==(e=s.value)||e.validateField("apk",(e=>{e&&(p.value=!0)}))},j=()=>{d.commitId="",d.moduleName="",d.pageUrl="",p.value=!1},C=()=>{var e;const a=t.value.getSelectionList().reduce(((e,a)=>{const l=e[a.pageUrl]??0;return{...e,[a.pageUrl]:l+1}}),{});Object.values(a).some((e=>e>1))?N({message:"有重复的页面, 把重复的选项去除后进行操作",type:"warning"}):(i.zips=t.value.getSelectionList(),p.value=!1,null==(e=s.value)||e.clearValidate("zips"))},E=()=>{console.log("值发生了变化"),i.zips=[]};return R((async()=>{const e=await Z({});n.value=e})),(e,o)=>(u(),m(V(q),{class:"home-page"},{default:f((()=>[c(V(A),{ref_key:"ruleFormRef",ref:s,model:i,rules:h,"label-width":"120px",class:"demo-ruleForm",size:"default","status-icon":""},{default:f((()=>[c(V($),{label:"版本号",prop:"version"},{default:f((()=>[c(V(D),{modelValue:i.version,"onUpdate:modelValue":o[0]||(o[0]=e=>i.version=e),class:"width-190",placeholder:"例如：1.0.1"},null,8,["modelValue"])])),_:1}),c(V($),{label:"apk选择",prop:"apk"},{default:f((()=>[c(V(M),{modelValue:i.apk,"onUpdate:modelValue":o[1]||(o[1]=e=>i.apk=e),placeholder:"请选择apk",onChange:E},{default:f((()=>[(u(!0),k(I,null,U(n.value,(e=>(u(),m(V(T),{label:e.appName,value:e.apkName,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(V($),{label:"zip选择"},{default:f((()=>[c(V(B),{type:"primary",onClick:_},{default:f((()=>[O("选择zip包")])),_:1})])),_:1}),i.zips.length?(u(),m(V($),{key:0},{default:f((()=>[c(V(K),{data:i.zips,border:""},{default:f((()=>[c(V(G),{prop:"pageName",label:"页面名称"}),c(V(G),{prop:"pageUrl",label:"链接"}),c(V(G),{prop:"zipMd5",label:"md5"}),c(V(G),{prop:"commitId",label:"commitId"}),c(V(G),{prop:"moduleName",label:"模块"}),c(V(G),{prop:"updatedTime",label:"上传时间"},{default:f((e=>[O(w(V(H)(e.row.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1}),c(V(G),{fixed:"right",label:"操作",width:"120"},{default:f((e=>[c(V(B),{type:"danger",size:"small",onClick:y((a=>(e=>{const a=i.zips.findIndex((a=>a.id===e));-1!==a&&i.zips.splice(a,1)})(e.row.id)),["prevent"])},{default:f((()=>[O(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})):z("",!0),c(V($),{label:"是否强制上线",prop:"forceOnline"},{default:f((()=>[c(V(Y),{modelValue:i.forceOnline,"onUpdate:modelValue":o[2]||(o[2]=e=>i.forceOnline=e)},{default:f((()=>[c(V(P),{label:1},{default:f((()=>[O("是")])),_:1}),c(V(P),{label:0},{default:f((()=>[O("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),c(V($),{label:"设备类型",prop:"device"},{default:f((()=>[c(V(M),{modelValue:i.device,"onUpdate:modelValue":o[3]||(o[3]=e=>i.device=e),placeholder:"请选择设备类型"},{default:f((()=>[c(V(T),{label:"Pad",value:"pad"})])),_:1},8,["modelValue"])])),_:1}),c(V($),null,{default:f((()=>[c(V(B),{type:"primary",onClick:o[4]||(o[4]=e=>(async e=>{e&&await e.validate((async(e,s)=>{if(e){if(console.log("submit!"),"1"==i.forceOnline&&i.zips.length>0)return void N.warning("请清空zip包");if("0"==i.forceOnline&&0===i.zips.length)return void N.error("请选择zip包");v.value=!0;const e={...i};e.zips=e.zips.map((e=>e.id)),await W(e).catch((()=>{})).finally((()=>{v.value=!1}))&&(N.success("保存成功"),a.emit("getList","add"),l("/localization/version-List"))}else console.log("error submit!",s)}))})(s.value))},{default:f((()=>[O("保存")])),_:1}),c(V(B),{onClick:o[5]||(o[5]=e=>{var a;(a=s.value)&&a.resetFields()})},{default:f((()=>[O("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"]),c(V(ne),{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=e=>p.value=e),title:"Zip资源选择",size:"80%"},{footer:f((()=>[b("span",pe,[c(V(B),{onClick:j},{default:f((()=>[O("取消")])),_:1}),c(V(B),{type:"primary",onClick:C},{default:f((()=>[O("确认")])),_:1})])])),default:f((()=>[c(Q,{ref_key:"zipListRef",ref:t,isShow:p.value,defaultList:i.zips,isChoose:!0,"apk-id":g.value},null,8,["isShow","defaultList","apk-id"])])),_:1},8,["modelValue"])])),_:1}))}});export{ue as default};
