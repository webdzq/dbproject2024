import{A as e,B as a,d as l,C as s,D as t,G as o,r,H as i,I as d,J as n,K as p,o as u,i as m,e as c,w as f,L as v,f as b,M as g,N as y,n as h,c as k,O as w,t as z,P as _,Q as j,h as C,R as E,S as x,u as S,s as V,q as R,a as L,F as U,U as I,x as O,y as N,_ as q}from"./index-14c99acf.js";import{E as A}from"./el-card-280f93ab.js";import{E as H,a as $}from"./el-form-item-6a11bdc7.js";import{u as B,E as D}from"./el-button-b39417c4.js";import{E as F}from"./el-input-90f914cc.js";import{d as M}from"./el-tag-b3f37f77.js";import{E as T,a as P}from"./el-select-562df675.js";import"./el-popper-423896a2.js";import{E as Y,a as Q}from"./el-radio-de30d299.js";import{E as G,a as J}from"./el-table-column-257bd6b9.js";import"./el-checkbox-23abc4dc.js";import{E as K}from"./el-overlay-e1a7640a.js";import Z from"./index-140f2ba9.js";import{c as W}from"./index-a11e7126.js";import{u as X}from"./useEmitt-24a6498c.js";import{g as ee}from"./index-1dc4238d.js";import{d as ae,a as le,u as se}from"./use-dialog-1fd54c37.js";import{E as te}from"./focus-trap-4b2fe507.js";import"./use-form-common-props-d73423f8.js";import"./use-form-item-95457b9b.js";import"./event-5568c9d8.js";import"./isNil-1f22f7b0.js";import"./scroll-48d2443d.js";import"./validator-4801b3bd.js";import"./vnode-8e602242.js";import"./el-row-b3405836.js";import"./el-pagination-7293d9ec.js";import"./index-a4774437.js";const oe=l({name:"ElDrawer",components:{ElOverlay:K,ElFocusTrap:te,ElIcon:s,Close:t},inheritAttrs:!1,props:e({...ae,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),emits:le,setup(e,{slots:a}){B({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},o((()=>!!a.title))),B({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},o((()=>!!e.customClass)));const l=r(),s=r(),t=i("drawer"),{t:p}=d(),u=o((()=>"rtl"===e.direction||"ltr"===e.direction)),m=o((()=>n(e.size)));return{...se(e,l),drawerRef:l,focusStartRef:s,isHorizontal:u,drawerSize:m,ns:t,t:p}}}),re=["aria-label","aria-labelledby","aria-describedby"],ie=["id"],de=["aria-label"],ne=["id"];const pe=x(a(oe,[["render",function(e,a,l,s,t,o){const r=p("close"),i=p("el-icon"),d=p("el-focus-trap"),n=p("el-overlay");return u(),m(E,{to:"body",disabled:!e.appendToBody},[c(C,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:f((()=>[v(c(n,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:f((()=>[c(d,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:f((()=>[b("div",g({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:a[1]||(a[1]=y((()=>{}),["stop"]))}),[b("span",{ref:"focusStartRef",class:h(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(u(),k("header",{key:0,class:h(e.ns.e("header"))},[e.$slots.title?w(e.$slots,"title",{key:1},(()=>[_(" DEPRECATED SLOT ")])):w(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},(()=>[e.$slots.title?_("v-if",!0):(u(),k("span",{key:0,id:e.titleId,role:"heading",class:h(e.ns.e("title"))},z(e.title),11,ie))])),e.showClose?(u(),k("button",{key:2,"aria-label":e.t("el.drawer.close"),class:h(e.ns.e("close-btn")),type:"button",onClick:a[0]||(a[0]=(...a)=>e.handleClose&&e.handleClose(...a))},[c(i,{class:h(e.ns.e("close"))},{default:f((()=>[c(r)])),_:1},8,["class"])],10,de)):_("v-if",!0)],2)):_("v-if",!0),e.rendered?(u(),k("div",{key:1,id:e.bodyId,class:h(e.ns.e("body"))},[w(e.$slots,"default")],10,ne)):_("v-if",!0),e.$slots.footer?(u(),k("div",{key:2,class:h(e.ns.e("footer"))},[w(e.$slots,"footer")],2)):_("v-if",!0)],16,re)])),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])])),_:3},8,["mask","overlay-class","z-index","onClick"]),[[j,e.visible]])])),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]])),ue={class:"dialog-footer"},me=q(l({__name:"index",setup(e){const{emitter:a}=X(),{push:l}=S(),s=r(),t=r(),i=V({version:"",apk:"",zips:[],forceOnline:"",device:"pad"}),d=V({pageUrl:"",commitId:"",moduleName:""}),n=r([]),p=r(!1),v=r(!1),g=o((()=>{const e=n.value.find((e=>e.apkName===i.apk));return e?e.id:""})),h=V({version:[{required:!0,message:"请输入版本号",trigger:"blur"},{validator:(e,a,l)=>{/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/.test(a)?l():l(new Error("请输入正确的版本号"))},trigger:"blur"}],apk:[{required:!0,message:"请选择apk",trigger:"change"}],zips:[{required:!0,message:"请选择zip",trigger:"change"}],forceOnline:[{required:!0,message:"请选择是否强制上线",trigger:"change"}],device:[{required:!0,message:"请选择设备类型",trigger:"change"}]}),w=()=>{var e;null==(e=s.value)||e.validateField("apk",(e=>{e&&(p.value=!0)}))},j=()=>{d.commitId="",d.moduleName="",d.pageUrl="",p.value=!1},C=()=>{var e;const a=t.value.getSelectionList().reduce(((e,a)=>{const l=e[a.pageUrl]??0;return{...e,[a.pageUrl]:l+1}}),{});Object.values(a).some((e=>e>1))?N({message:"有重复的页面, 把重复的选项去除后进行操作",type:"warning"}):(i.zips=t.value.getSelectionList(),p.value=!1,null==(e=s.value)||e.clearValidate("zips"))},E=()=>{console.log("值发生了变化"),i.zips=[]};return R((async()=>{const e=await ee({});n.value=e})),(e,o)=>(u(),m(L(A),{class:"home-page"},{default:f((()=>[c(L(H),{ref_key:"ruleFormRef",ref:s,model:i,rules:h,"label-width":"120px",class:"demo-ruleForm",size:"default","status-icon":""},{default:f((()=>[c(L($),{label:"版本号",prop:"version"},{default:f((()=>[c(L(F),{modelValue:i.version,"onUpdate:modelValue":o[0]||(o[0]=e=>i.version=e),class:"width-190",placeholder:"例如：1.0.1"},null,8,["modelValue"])])),_:1}),c(L($),{label:"apk选择",prop:"apk"},{default:f((()=>[c(L(T),{modelValue:i.apk,"onUpdate:modelValue":o[1]||(o[1]=e=>i.apk=e),placeholder:"请选择apk",onChange:E},{default:f((()=>[(u(!0),k(U,null,I(n.value,(e=>(u(),m(L(P),{label:e.appName,value:e.apkName,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(L($),{label:"zip选择"},{default:f((()=>[c(L(D),{type:"primary",onClick:w},{default:f((()=>[O("选择zip包")])),_:1})])),_:1}),i.zips.length?(u(),m(L($),{key:0},{default:f((()=>[c(L(G),{data:i.zips,border:""},{default:f((()=>[c(L(J),{prop:"pageName",label:"页面名称"}),c(L(J),{prop:"pageUrl",label:"链接"}),c(L(J),{prop:"zipMd5",label:"md5"}),c(L(J),{prop:"commitId",label:"commitId"}),c(L(J),{prop:"moduleName",label:"模块"}),c(L(J),{prop:"updatedTime",label:"上传时间"},{default:f((e=>[O(z(L(M)(e.row.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1}),c(L(J),{fixed:"right",label:"操作",width:"120"},{default:f((e=>[c(L(D),{type:"danger",size:"small",onClick:y((a=>(e=>{const a=i.zips.findIndex((a=>a.id===e));-1!==a&&i.zips.splice(a,1)})(e.row.id)),["prevent"])},{default:f((()=>[O(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})):_("v-if",!0),c(L($),{label:"是否强制上线",prop:"forceOnline"},{default:f((()=>[c(L(Y),{modelValue:i.forceOnline,"onUpdate:modelValue":o[2]||(o[2]=e=>i.forceOnline=e)},{default:f((()=>[c(L(Q),{label:1},{default:f((()=>[O("是")])),_:1}),c(L(Q),{label:0},{default:f((()=>[O("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),c(L($),{label:"设备类型",prop:"device"},{default:f((()=>[c(L(T),{modelValue:i.device,"onUpdate:modelValue":o[3]||(o[3]=e=>i.device=e),placeholder:"请选择设备类型"},{default:f((()=>[c(L(P),{label:"Pad",value:"pad"})])),_:1},8,["modelValue"])])),_:1}),c(L($),null,{default:f((()=>[c(L(D),{type:"primary",onClick:o[4]||(o[4]=e=>(async e=>{e&&await e.validate((async(e,s)=>{if(e){if(console.log("submit!"),"1"==i.forceOnline&&i.zips.length>0)return void N.warning("请清空zip包");if("0"==i.forceOnline&&0===i.zips.length)return void N.error("请选择zip包");v.value=!0;const e={...i};e.zips=e.zips.map((e=>e.id)),await W(e).catch((()=>{})).finally((()=>{v.value=!1}))&&(N.success("保存成功"),a.emit("getList","add"),l("/localization/version-List"))}else console.log("error submit!",s)}))})(s.value))},{default:f((()=>[O("保存")])),_:1}),c(L(D),{onClick:o[5]||(o[5]=e=>{var a;(a=s.value)&&a.resetFields()})},{default:f((()=>[O("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"]),c(L(pe),{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=e=>p.value=e),title:"Zip资源选择",size:"80%"},{footer:f((()=>[b("span",ue,[c(L(D),{onClick:j},{default:f((()=>[O("取消")])),_:1}),c(L(D),{type:"primary",onClick:C},{default:f((()=>[O("确认")])),_:1})])])),default:f((()=>[c(Z,{ref_key:"zipListRef",ref:t,isShow:p.value,defaultList:i.zips,isChoose:!0,"apk-id":g.value},null,8,["isShow","defaultList","apk-id"])])),_:1},8,["modelValue"])])),_:1}))}}),[["__file","/Users/zyb-dong/github/project425/fontend/src/views/Home/index.vue"]]);export{me as default};
