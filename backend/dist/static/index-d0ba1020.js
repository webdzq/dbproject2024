import{u as e,a,_ as t,b as s,c as l}from"./useCrudSchemas-b817de72.js";import{d as o,k as n,u as i,r,q as c,s as p,v as u,e as d,x as m,F as f,y as g,o as h,c as y,w as v,a as E,f as j,z as b}from"./index-d5304777.js";import{E as _,d as w}from"./el-tag-377e0f90.js";import{E as P}from"./el-button-7384c59f.js";import{E as S}from"./tree-05cd14e5.js";import"./el-input-18a8a90e.js";import"./el-overlay-cfbba524.js";import{o as k,u as I,g as T,r as D}from"./index-98d51863.js";import{u as x}from"./useEmitt-da8011a9.js";import{_ as C}from"./PercentDialog.vue_vue_type_script_setup_true_lang-1dc65321.js";import{g as O}from"./index-104a7b48.js";import"./el-card-2b130a3f.js";import"./el-popper-20328552.js";import"./isNil-1f22f7b0.js";import"./use-form-common-props-594ab9f4.js";import"./focus-trap-5bb091fd.js";import"./useForm-aca3a07d.js";import"./el-form-item-38df9850.js";import"./el-row-da9cc34b.js";import"./el-checkbox-b2c1ef9f.js";import"./event-5568c9d8.js";import"./use-form-item-6b2ca231.js";import"./el-radio-827539ee.js";import"./el-select-ce060cba.js";import"./scroll-8db753ac.js";import"./validator-a82dd364.js";import"./aria-ecee1d93.js";import"./index-2e3c1611.js";import"./el-table-column-0c648863.js";import"./el-pagination-60cf2577.js";import"./index-ed3b1f85.js";import"./vnode-925e3556.js";import"./use-dialog-7a60bb62.js";const V={class:"mb-10px"},L=o({name:"VersionList"}),R=o({...L,setup(o){const L={VITE_API_BASE_PATH:"pro",VITE_BASE_PATH:"./",VITE_DROP_DEBUGGER:"true",VITE_DROP_CONSOLE:"true",VITE_SOURCEMAP:"false",VITE_OUT_DIR:"dist",VITE_BUILD_MODE:"online",VITE_APP_TITLE:"FE项目发布系统",VITE_USER_NODE_ENV:"online",BASE_URL:"./",MODE:"pro",DEV:!1,PROD:!0,SSR:!1};console.log("ENV",L);const{t:R}=n(),{push:B}=i(),M=r({}),z=r([]),A=r(!1),N=e=>{M.value=e,Q()},{tableRegister:U,tableState:H,tableMethods:$}=e({fetchDataApi:async()=>{const{currentPage:e,pageSize:a}=H,t=await T({page:E(e),limit:E(a),...E(M)});return{list:t.items,total:t.meta.total}}}),{loading:F,dataList:Y,total:G,currentPage:q,pageSize:W}=H,{getList:Q}=$;x({name:"getList",callback:e=>{"add"===e&&(q.value=1),Q()}}),c((async()=>{const e=await O({});z.value=e.map((e=>({label:e.appName,value:e.apkName})))}));const X=p([{field:"id",label:"Id",search:{hidden:!0}},{field:"apk",label:"apk名称",search:{component:"Select",componentProps:{options:z}},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"appName",label:"apk包名",search:{hidden:!0}},{field:"version",label:"版本号",search:{component:"Input"},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"status",label:"状态",search:{component:"Select",componentProps:{options:[{label:"下线",value:"offline"},{label:"默认",value:"default"},{label:"test",value:"test"},{label:"tips",value:"tips"},{label:"灰度",value:"gray"},{label:"上线",value:"online"}]}},form:{component:"Input",colProps:{span:24}},formatter:(e,a,t)=>K(t)},{field:"forceOnline",label:"是否强制上线",search:{hidden:!0},formatter:(e,a,t)=>u(_,{type:1===t?"success":"danger"},(()=>1===t?"是":"否"))},{field:"device",label:"设备类型",search:{component:"Input"},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"createdBy",label:"创建人",search:{hidden:!0}},{field:"updatedBy",label:"更新人",search:{hidden:!0}},{field:"updatedTime",label:"更新时间",search:{hidden:!0},formatter:(e,a,t)=>w(t).format("YYYY-MM-DD HH:mm:ss")},{field:"action",label:"操作",width:"300px",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{slots:{default:e=>d(f,null,[d("div",{class:"action-btns",style:"display: flex; flex-wrap: wrap"},[d(P,{type:"primary",onClick:()=>ae(e[0].row,"detail")},{default:()=>[m("详情")]}),["default"].includes(e[0].row.status)&&"pro"!==L.MODE&&d(P,{type:"success",onClick:()=>ae(e[0].row,"test")},{default:()=>[m("test")]}),["default"].includes(e[0].row.status)&&"pro"===L.MODE&&d(P,{type:"success",onClick:()=>ae(e[0].row,"tips")},{default:()=>[m("tips")]}),["gray"].includes(e[0].row.status)&&"pro"===L.MODE&&d(P,{type:"success",onClick:()=>ae(e[0].row,"online")},{default:()=>[m("上线")]}),["gray","tips","online","test"].includes(e[0].row.status)&&d(P,{type:"danger",onClick:()=>ae(e[0].row,"offline")},{default:()=>[m("下线")]}),["tips"].includes(e[0].row.status)&&"pro"===L.MODE&&d(P,{type:"success",onClick:()=>ae(e[0].row,"gray")},{default:()=>[m("灰度")]}),d(P,{type:"success",color:"#626aef",onClick:()=>ae(e[0].row,"diff")},{default:()=>[m("diff")]}),!["default","offline"].includes(e[0].row.status)&&d(P,{type:"warning",onClick:()=>ae(e[0].row,"limit")},{default:()=>[m("放量")]})])])}}}]),{allSchemas:J}=a(X),K=e=>{switch(e){case"offline":return"已下线";case"default":default:return"默认";case"test":case"test":return"test";case"tips":return"tips";case"gray":return"灰度";case"online":return"上线"}},Z=r(-1),ee=r(""),ae=(e,a)=>{"detail"===a?B(`/localization/version-detail?id=${e.id}`):"diff"===a?B(`/localization/diff-page?id=${e.id}&version=${e.version}&apk=${e.apk}`):"limit"===a?(ee.value=e.snList,A.value=!0):"offline"===a?S.prompt("请输入下线备注","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[\s\S]*.*[^\s][\s\S]*$/,inputErrorMessage:"请输入下线备注"}).then((async({value:a})=>{const t={id:e.id,remark:a};try{await k(t)&&(g({message:"下线成功",type:"success"}),Q())}catch(s){console.log("---err---:",s)}})).catch((()=>{})):["default","test","tips","gray","online"].includes(a)&&te(e.id,a),Z.value=e.id},te=async(e,a)=>{S.confirm(u("p",null,[u("span",null,"是否切换当前数据为"),u("span",{style:"color: red;font-size: 20px;"},a)]),R("common.delWarning"),{confirmButtonText:R("common.delOk"),cancelButtonText:R("common.delCancel"),type:"warning"}).then((async()=>{const t={id:e,status:a};try{await I(t)&&(g({message:"状态变更成功",type:"success"}),Q())}catch(s){console.log("---err---:",s)}}))},se=()=>{B("/localization/creat-packages")},le=e=>{(async(e,a)=>{const t={id:e,snList:a};try{await D(t)&&(g({message:"放量成功",type:"success"}),Q())}catch(s){console.log("---err---:",s)}})(Z.value,e.sns),oe()},oe=()=>{A.value=!1};return(e,a)=>(h(),y(f,null,[d(E(l),null,{default:v((()=>[d(E(t),{schema:E(J).searchSchema,onSearch:N},null,8,["schema"]),j("div",V,[d(E(P),{type:"primary",onClick:se},{default:v((()=>[m("创建")])),_:1})]),d(E(s),{pageSize:E(W),"onUpdate:pageSize":a[0]||(a[0]=e=>b(W)?W.value=e:null),currentPage:E(q),"onUpdate:currentPage":a[1]||(a[1]=e=>b(q)?q.value=e:null),columns:E(J).tableColumns,data:E(Y),loading:E(F),pagination:{total:E(G)},onRegister:E(U)},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])),_:1}),d(C,{visable:A.value,snList:ee.value,onCancelPercent:oe,onChangePercent:le},null,8,["visable","snList"])],64))}});export{R as default};
