import{_ as e}from"./ContentDetailWrap.vue_vue_type_script_setup_true_lang-bf673a00.js";import{u as a}from"./useEmitt-da8011a9.js";import{d as s,u as l,s as p,r as t,W as r,ay as i,o,i as m,w as u,e as d,a as n,x as c,L as g,P as f,y as N}from"./index-d5304777.js";import{u as _,c as k,d as v}from"./index-104a7b48.js";import{E as y,a as b}from"./el-form-item-38df9850.js";import{E as j}from"./el-button-7384c59f.js";import{E as h}from"./el-input-18a8a90e.js";import"./el-card-2b130a3f.js";import"./use-form-common-props-594ab9f4.js";import"./use-form-item-6b2ca231.js";import"./event-5568c9d8.js";import"./isNil-1f22f7b0.js";const w=s({__name:"add",setup(s){const{push:w,go:V}=l(),{emitter:q}=a(),x=p({apkName:[{required:!0,message:"Apk name is required",trigger:"blur"}],appName:[{required:!0,message:"App name is required",trigger:"blur"}],pages:[{required:!0,message:"Pages are required",trigger:"blur"}]}),C=t(),{query:z}=r(),E=t(!1),U=t(!1),A=p({apkName:"",appName:"",pages:""});return z.id&&(async()=>{U.value=!0;const e=await v({id:z.id});e&&(A.apkName=e.apkName,A.appName=e.appName,A.pages=e.pages.reduce(((e,a)=>e+",\n"+a)),U.value=!1)})(),(a,s)=>{const l=i("loading");return o(),m(n(e),{title:n(z).id?"编辑":"页面映射新增",onBack:s[6]||(s[6]=e=>n(w)("/localization/page-map"))},{header:u((()=>[d(n(j),{onClick:s[0]||(s[0]=e=>n(V)(-1))},{default:u((()=>[c("返回")])),_:1})])),default:u((()=>[g((o(),m(n(y),{ref_key:"ruleFormRef",ref:C,model:A,rules:x,"label-width":"120px",class:"demo-ruleForm",size:"default","status-icon":""},{default:u((()=>[d(n(b),{label:"包名",prop:"apkName"},{default:u((()=>[d(n(h),{modelValue:A.apkName,"onUpdate:modelValue":s[1]||(s[1]=e=>A.apkName=e),class:"width-190",placeholder:"请输入包名",disabled:!!n(z).id},null,8,["modelValue","disabled"])])),_:1}),d(n(b),{label:"应用名称",prop:"appName"},{default:u((()=>[d(n(h),{modelValue:A.appName,"onUpdate:modelValue":s[2]||(s[2]=e=>A.appName=e),class:"width-190",placeholder:"请输入应用名称"},null,8,["modelValue"])])),_:1}),d(n(b),{label:"页面列表",prop:"pages"},{default:u((()=>[d(n(h),{modelValue:A.pages,"onUpdate:modelValue":s[3]||(s[3]=e=>A.pages=e),class:"width-190",placeholder:"多个页面请用逗号隔开",type:"textarea",autosize:""},null,8,["modelValue"])])),_:1}),d(n(b),null,{default:u((()=>[d(n(j),{type:"primary",onClick:s[4]||(s[4]=e=>(async e=>{e&&await e.validate((async(e,a)=>{if(e){console.log("submit!",A.pages,A.pages.split(","));const e=A.pages.split(",").map((e=>e.trim()));console.log(e),E.value=!0;const a={apkName:A.apkName,appName:A.appName,pages:e};let s;if(z.id){const a={id:Number(z.id),appName:A.appName,pages:e};s=await _(a).catch((()=>{})).finally((()=>{E.value=!1}))}else s=await k(a).catch((()=>{})).finally((()=>{E.value=!1}));s&&(N.success(z.id?"更新成功":"保存成功"),q.emit("getApkList","add"),w("/localization/page-map"))}else console.log("error submit!",a)}))})(C.value))},{default:u((()=>[c("保存")])),_:1}),n(z).id?f("",!0):(o(),m(n(j),{key:0,onClick:s[5]||(s[5]=e=>{var a;(a=C.value)&&a.resetFields()})},{default:u((()=>[c("重置")])),_:1}))])),_:1})])),_:1},8,["model","rules"])),[[l,U.value]])])),_:1},8,["title"])}}});export{w as default};
